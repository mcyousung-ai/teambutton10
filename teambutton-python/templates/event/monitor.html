{% extends "base.html" %}
{% block nav %}{% endblock %}
{% block title %}ëª¨ë‹ˆí„° - {{ event.title }}{% endblock %}
{% block content %}
<div style="min-height:100vh;padding:24px;background:linear-gradient(135deg,#0f172a,#1e1b4b)">
<div class="text-center mb-4"><h1 style="font-size:32px;font-weight:800">{{ event.title }}</h1><p class="text-muted text-lg">{{ event.company_name }}</p><span class="badge badge-gray" id="mStatus" style="font-size:14px;padding:6px 16px">{{ event.status }}</span></div>
<div id="monitorContent">
<!-- Scoreboard -->
<div class="container">
{% if teams %}
<h2 class="text-center mb-4">íŒ€ ìˆœìœ„</h2>
<div class="grid grid-{{ [teams|length, 4]|min }}" style="max-width:800px;margin:0 auto">
{% for t in teams %}
<div class="card text-center" style="{% if loop.index == 1 %}border-color:gold;background:rgba(255,215,0,.1){% endif %}">
<div style="font-size:32px">{% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% elif loop.index == 3 %}ğŸ¥‰{% else %}{{ loop.index }}{% endif %}</div>
<h3>{{ t.name }}</h3>
<div style="font-size:36px;font-weight:800;color:var(--primary-light)">{{ t.score }}</div>
</div>
{% endfor %}
</div>
{% endif %}
<h2 class="text-center mb-4 mt-4">ê°œì¸ ìˆœìœ„</h2>
<div class="card" style="max-width:600px;margin:0 auto">
<table><thead><tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>{% if teams %}íŒ€{% endif %}</th><th>ì ìˆ˜</th></tr></thead>
<tbody id="mRanking">
{% for p in participants[:20] %}
<tr><td>{% if loop.index <= 3 %}<span style="font-size:20px">{% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% else %}ğŸ¥‰{% endif %}</span>{% else %}{{ loop.index }}{% endif %}</td><td>{{ p.name }}</td><td>{{ p.team_name or '' }}</td><td style="font-weight:700;color:var(--primary-light)">{{ p.score }}</td></tr>
{% endfor %}
</tbody></table>
</div>
</div>
</div>
</div>
<script>
const S=io(),E={{ event.id }};
S.emit('participant:join',{eventId:E});
S.on('event:started',()=>{$('mStatus').textContent='ì§„í–‰ì¤‘';$('mStatus').className='badge badge-success';});
S.on('event:ended',()=>{$('mStatus').textContent='ì¢…ë£Œ';$('mStatus').className='badge badge-danger';});
S.on('participants:updated',d=>{const ps=d.participants.sort((a,b)=>b.score-a.score);const el=$('mRanking');el.innerHTML='';ps.slice(0,20).forEach((p,i)=>{el.innerHTML+=`<tr><td>${i<3?['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]:(i+1)}</td><td>${p.name}</td><td>${p.team_name||''}</td><td style="font-weight:700;color:var(--primary-light)">${p.score}</td></tr>`;});});
S.on('game:buzzer_count_winner',d=>{$('monitorContent').innerHTML='<div class="text-center" style="padding:60px"><h1 style="font-size:48px">ğŸ†</h1><h2 style="font-size:36px;margin:16px 0">'+d.winner.name+'</h2><p class="text-lg text-muted">'+d.winner.clicks+' í´ë¦­</p></div>';});
S.on('game:lottery_result',d=>{$('monitorContent').innerHTML='<div class="text-center" style="padding:60px"><h1 style="font-size:48px">ğŸ‰</h1><h2 style="font-size:36px;margin:16px 0">'+d.winners.join(', ')+'</h2></div>';});
S.on('timer:tick',d=>{const m=Math.floor(d.remaining/60),s=d.remaining%60;document.title=m+':'+String(s).padStart(2,'0');});
function $(id){return document.getElementById(id)}
</script>
{% endblock %}
