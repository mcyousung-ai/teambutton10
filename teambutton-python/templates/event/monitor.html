{% extends "base.html" %}
{% block nav %}{% endblock %}
{% block title %}ëª¨ë‹ˆí„° - {{ event.title }}{% endblock %}
{% block extra_css %}
<style>
body{background:linear-gradient(145deg,#0f172a 0%,#1e1b4b 50%,#0f172a 100%);color:#E2E8F0;min-height:100vh}
.mon-header{text-align:center;padding:32px 16px 16px}
.mon-header h1{font-size:36px;font-weight:900;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.3)}
.mon-header p{font-size:16px;color:#94A3B8;margin-top:4px}
.rank-card{background:rgba(255,255,255,.05);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);border-radius:20px;padding:24px;margin:16px;box-shadow:0 8px 32px rgba(0,0,0,.2)}
.rank-card h2{font-size:20px;font-weight:700;color:#fff;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.team-grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
.team-box{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);border-radius:16px;padding:20px;text-align:center;transition:all .3s}
.team-box.gold{background:rgba(255,215,0,.12);border-color:rgba(255,215,0,.3)}
.team-box .medal{font-size:36px;margin-bottom:8px}
.team-box .name{font-size:18px;font-weight:700;color:#fff}
.team-box .score{font-size:32px;font-weight:900;color:var(--point-300);margin-top:4px}
.rank-table{width:100%;border-collapse:separate;border-spacing:0 6px}
.rank-table tr{background:rgba(255,255,255,.04);border-radius:12px;transition:all .2s}
.rank-table tr:hover{background:rgba(255,255,255,.08)}
.rank-table td{padding:12px 16px;font-size:14px;color:#CBD5E1}
.rank-table td:first-child{border-radius:12px 0 0 12px;font-weight:700;width:50px;text-align:center}
.rank-table td:last-child{border-radius:0 12px 12px 0;text-align:right;font-weight:800;color:var(--point-300);font-size:18px;font-variant-numeric:tabular-nums}
.rank-medal{font-size:24px}
.game-overlay{position:fixed;inset:0;background:rgba(15,23,42,.95);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:100;text-align:center;padding:24px}
.game-overlay h1{font-size:60px;margin-bottom:16px}
.game-overlay h2{font-size:36px;font-weight:900;color:#fff}
.game-overlay p{font-size:20px;color:#94A3B8}
</style>
{% endblock %}
{% block content %}
<div class="mon-header">
<h1>{{ event.title }}</h1>
<p>{{ event.company_name }}</p>
<span class="badge badge-gray" id="mStat" style="margin-top:8px;font-size:14px;padding:6px 16px">{{ event.status }}</span>
</div>
<div id="monitorBody">
{% if teams %}
<div class="rank-card">
<h2>ğŸ… íŒ€ ìˆœìœ„</h2>
<div class="team-grid">
{% for t in teams %}
<div class="team-box {% if loop.index == 1 %}gold{% endif %}">
<div class="medal">{% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% elif loop.index == 3 %}ğŸ¥‰{% else %}{{ loop.index }}{% endif %}</div>
<div class="name">{{ t.name }}</div>
<div class="score">{{ t.score }}</div>
</div>
{% endfor %}
</div>
</div>
{% endif %}
<div class="rank-card">
<h2>ğŸ‘‘ ê°œì¸ ìˆœìœ„</h2>
<table class="rank-table" id="mRank">
{% for p in participants[:20] %}
<tr>
<td>{% if loop.index <= 3 %}<span class="rank-medal">{% if loop.index == 1 %}ğŸ¥‡{% elif loop.index == 2 %}ğŸ¥ˆ{% else %}ğŸ¥‰{% endif %}</span>{% else %}{{ loop.index }}{% endif %}</td>
<td style="font-weight:600;color:#fff">{{ p.name }}</td>
<td style="color:#94A3B8">{{ p.team_name or '' }}</td>
<td>{{ p.score }}</td>
</tr>
{% endfor %}
</table>
</div>
</div>
<div id="gameOverlay" class="game-overlay hidden"></div>
<script>
const S=io(),E={{ event.id }};
S.emit('participant:join',{eventId:E});
S.on('event:started',()=>{$('mStat').textContent='ì§„í–‰ì¤‘';$('mStat').className='badge badge-success'});
S.on('event:ended',()=>{$('mStat').textContent='ì¢…ë£Œ';$('mStat').className='badge badge-danger'});
S.on('participants:updated',d=>{const ps=d.participants.sort((a,b)=>b.score-a.score);const el=$('mRank');el.innerHTML='';ps.slice(0,20).forEach((p,i)=>{el.innerHTML+=`<tr><td>${i<3?['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'][i]:(i+1)}</td><td style="font-weight:600;color:#fff">${p.name}</td><td style="color:#94A3B8">${p.team_name||''}</td><td>${p.score}</td></tr>`})});
S.on('game:buzzer_count_winner',d=>{const o=$('gameOverlay');o.classList.remove('hidden');o.innerHTML=`<div><h1>ğŸ†</h1><h2>${d.winner.name}</h2><p>${d.winner.clicks} í´ë¦­ìœ¼ë¡œ ìš°ìŠ¹!</p></div>`;setTimeout(()=>o.classList.add('hidden'),8000)});
S.on('game:lottery_result',d=>{const o=$('gameOverlay');o.classList.remove('hidden');o.innerHTML=`<div><h1>ğŸ‰</h1><h2>${d.winners.join(', ')}</h2><p>ì¶•í•˜í•©ë‹ˆë‹¤!</p></div>`;setTimeout(()=>o.classList.add('hidden'),8000)});
S.on('timer:tick',d=>{const m=Math.floor(d.remaining/60),s=d.remaining%60;document.title=m+':'+String(s).padStart(2,'0')});
function $(id){return document.getElementById(id)}
</script>
{% endblock %}
